<?xml version="1.0" encoding="UTF-8"?>
<Agentinstructions>
    <Role>
        <Name>OpenAI Assistant Agent</Name>
        <Description>专门调用OpenAI API的智能助手workflow</Description>
        <currentDate>{{$now}}</currentDate>
    </Role>
    <Goal>
        <Primary>接收用户消息，通过OpenAI API生成智能回复</Primary>
        <Secondary>提供友好的用户界面和错误处理</Secondary>
    </Goal>
    <Instructions>
        <Instruction>接收POST请求到/openai端点</Instruction>
        <Instruction>验证请求包含message字段</Instruction>
        <Instruction>调用OpenAI GPT-3.5-turbo API</Instruction>
        <Instruction>返回格式化的JSON响应</Instruction>
        <Instruction>处理API错误和超时情况</Instruction>
    </Instructions>
    <Tools>
        <Tool>Webhook节点 - 接收HTTP请求</Tool>
        <Tool>Set节点 - 验证和准备数据</Tool>
        <Tool>HTTP Request节点 - 调用OpenAI API</Tool>
        <Tool>Set节点 - 格式化响应</Tool>
        <Tool>Respond to Webhook节点 - 返回结果</Tool>
    </Tools>
    <Constraints>
        <Constraint>必须验证OpenAI API Key</Constraint>
        <Constraint>处理API调用失败的情况</Constraint>
        <Constraint>限制响应长度避免过度消耗</Constraint>
    </Constraints>
    <ExecutionContext>
        <Environment>development</Environment>
        <Timezone>Asia/Shanghai</Timezone>
        <Language>zh-CN</Language>
    </ExecutionContext>
    <ErrorHandling>
        <RetryStrategy>exponential</RetryStrategy>
        <MaxRetries>2</MaxRetries>
        <FallbackAction>返回友好错误信息</FallbackAction>
    </ErrorHandling>
    <Validation>
        <RequiredFields>
            <Field>message</Field>
        </RequiredFields>
        <FormatRules>
            <Rule field="message">消息不能为空且长度不超过1000字符</Rule>
        </FormatRules>
    </Validation>
    <Examples>
        <Example>
            <Context>用户发送正常消息</Context>
            <UserInput>{"message": "请解释什么是机器学习"}</UserInput>
            <AgentOutput>{"response": "机器学习是人工智能的一个分支...", "status": "success", "timestamp": "2025-11-11T..."}</AgentOutput>
            <Notes>正常API调用成功的情况</Notes>
        </Example>
        <Example>
            <Context>API调用失败</Context>
            <UserInput>{"message": "测试错误处理"}</UserInput>
            <AgentOutput>{"error": "OpenAI API调用失败，请稍后重试", "status": "error"}</AgentOutput>
            <Notes>演示错误处理机制</Notes>
        </Example>
    </Examples>
    <Security>
        <Authentication>
            <Type>api_key</Type>
            <Expiration>3600</Expiration>
        </Authentication>
    </Security>
    <Integrations>
        <Service name="openai">
            <Provider>OpenAI</Provider>
            <Config>
                <Host>api.openai.com</Host>
                <Port>443</Port>
                <Endpoint>/v1/chat/completions</Endpoint>
            </Config>
        </Service>
    </Integrations>
    <Metrics>
        <Track>
            <Metric>api_calls</Metric>
            <Metric>response_time</Metric>
            <Metric>error_rate</Metric>
        </Track>
    </Metrics>
</Agentinstructions>
